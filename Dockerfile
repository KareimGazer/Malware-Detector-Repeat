FROM ubuntu:18.04 AS build-c

RUN apt-get update
RUN apt-get install -y build-essential

WORKDIR /usr/src

COPY ./memEat.c .
COPY ./bomb.c .

RUN gcc memEat.c -o memEat

RUN gcc bomb.c -o bomb

FROM python

RUN pip install psutil

WORKDIR /usr/src

COPY --from=build-c /usr/src/memEat /usr/src/memEat
COPY --from=build-c /usr/src/bomb /usr/src/bomb

RUN chmod +x /usr/src/memEat
RUN chmod +x /usr/src/bomb

COPY ./*.py .

RUN groupadd -r myuser && useradd -r -g myuser myuser

USER myuser

ENTRYPOINT [ "python", "main.py" ]
